<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Stock YNDX</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="i/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="i/apple-touch-icon-180x180.png" />
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #000;
            margin: 0px;
            color: #fff;
            transition: background-image 3s;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=);
            background-attachment: fixed;
            background-size: cover;
            width: 100%;
            height: 100%;
            position: fixed;
            box-sizing: border-box;
        }

        .card {
            box-sizing: border-box;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.1) 10%, rgba(0, 0, 0, 1) 100%);
            display: flex;
            width: 100%;
            flex-direction: column;
            justify-content: flex-end;
            padding: 60px 10px 10px 10px;
            bottom: 0;
            position: absolute;
        }

        .card-content+.card-content {
            margin-top: 20px;
        }

        .headline {
            font-size: 18vh;
            font-weight: 200;
        }

        .change,
        .price-usd {
            font-size: 6vw;
            padding-left: 10px;
            line-height: 8vw;
            font-weight: 200;
        }

        .ticker {
            padding: 0 0 0 4px;
        }

        .spacing {
            letter-spacing: 4px;
        }

        #card-moex .price {
            cursor: pointer;
        }

        .red {
            color: #db5856;
        }

        .green {
            color: #77dd77;
        }

        @media (max-width:768px) {
            .headline {
                font-size: 16vw;
            }

            .change {
                font-weight: 300;
            }
        }
    </style>

</head>

<body>

    <!--
    <div class="card">
        <div class="card-content" id="card-nasdaq">
            <div class="ticker"><span class="spacing">YNDX</span></div>
            <div class="headline"><span class="spacing price">$20.25</span><span class="change red">−0.07</span></div>
        </div>

        <div class="card-content" id="card-moex">
            <div class="ticker">YNDX (MOEX)</div>
            <div class="headline"><span class="spacing price">1930₽</span><span class="change green">+60</span></div>
        </div>

        <div class="card-content" id="card-forex">
            <div class="ticker">USD/RUB</div>
            <div class="headline"><span class="spacing price">$82.86</span><span class="change green">−1.86</span></div>
        </div>

    </div>
    -->
    <div class="card">
        <div class="card-content" id="card-nasdaq">
            <div class="ticker"><span class="spacing">YNDX</span></div>
            <div class="headline"><span class="spacing price">…</span><span class="change"></span></div>
        </div>

        <div class="card-content" id="card-moex">
            <div class="ticker">YNDX (MOEX)</div>
            <div class="headline"><span class="spacing price">…</span><span class="change"></span></div>
        </div>

        <div class="card-content" id="card-forex">
            <div class="ticker">USD/RUB</div>
            <div class="headline"><span class="spacing price">…</span><span class="change"></span></div>
        </div>

    </div>


</body>

<script type="text/javascript">
    const phone = 'https://source.unsplash.com/700x1624';
    const desktop = 'https://source.unsplash.com/1920x1080';
    const img = window.innerWidth <= 768 ? phone : desktop;

    const image = new Image();
    image.src = img;

    image.onload = function (e) {
        document.body.style.backgroundImage = `url(${img})`;
    };

    const api_keys = [
        'ucNm3Bv41T4cZXmGpvvZjdBoC69664k6oKqaTmX2',
        'qoAwPkv9sG3LjOcyD3P54tcLUwV1SkyHsuUzK5e0',
        'kGti1FE2Fy9QeBcFtfcDU6rOYYdgWA6P4lLglJkv',
    ];

    fetch('https://yfapi.net/v6/finance/quote?region=RU&lang=RU&symbols=YNDX%2CYNDX.ME%2CUSDRUB%3DX', {
        method: 'GET',
        headers: {
            'X-API-KEY': api_keys[Math.floor(Math.random() * api_keys.length)]
        }
    }).then(r => r.json()).then(data => {
        const nasdaq = data.quoteResponse.result[0];
        const moex = data.quoteResponse.result[1];
        const forex = data.quoteResponse.result[2];

        const yndx = nasdaq.regularMarketPrice.toFixed(2);
        const yndxMe = moex.regularMarketPrice;
        const usd = forex.regularMarketPrice.toFixed(2);

        // nasdaq
        let nasdaqPostfix = (nasdaq.regularMarketChange > 0 ? '+' : '') + nasdaq.regularMarketChange.toFixed(2).toString().replace('-', '−');
        let nasdaqColor = nasdaq.regularMarketChange > 0 ? 'green' : 'red';
        document.querySelector('#card-nasdaq .headline .price').innerHTML = `$${yndx}`;
        document.querySelector('#card-nasdaq .headline .change').innerHTML = nasdaqPostfix;
        document.querySelector('#card-nasdaq .headline .change').className = 'change ' + nasdaqColor;

        // moex
        let moexPostfix = (moex.regularMarketChange > 0 ? '+' : '') + moex.regularMarketChange.toFixed(0).toString().replace('-', '−');
        let moexColor = moex.regularMarketChange > 0 ? 'green' : 'red';
        document.querySelector('#card-moex .headline .price').innerHTML = `${yndxMe}₽`;
        document.querySelector('#card-moex .headline .change').innerHTML = moexPostfix;
        document.querySelector('#card-moex .headline .change').className = 'change ' + moexColor;

        let clickState = 0;
        document.querySelector('#card-moex .headline .price').addEventListener('click', () => {
            if (clickState === 0) {
                document.querySelector('#card-moex .headline .price').innerHTML = '$' + (yndxMe / usd).toFixed(2);
                document.querySelector('#card-moex .headline .change').innerHTML = (moex.regularMarketChange.toFixed(0) / usd).toFixed(2);
                clickState = 1;
            } else {
                document.querySelector('#card-moex .headline .price').innerHTML = `${yndxMe}₽$`;
                document.querySelector('#card-moex .headline .change').innerHTML = moexPostfix;
                clickState = 0;
            }
        }, false);

        // usdrub
        let forexPostfix = (forex.regularMarketChange > 0 ? '+' : '') + forex.regularMarketChange.toFixed(2).toString().replace('-', '−');
        let forexColor = forex.regularMarketChange > 0 ? 'red' : 'green';
        document.querySelector('#card-forex .headline .price').innerHTML = `$${usd}`;
        document.querySelector('#card-forex .headline .change').innerHTML = forexPostfix;
        document.querySelector('#card-forex .headline .change').className = 'change ' + forexColor;
    }).catch(e => {
        console.error(e);
    });

</script>

</html>